FROM debian:8

RUN apt-get update && apt-get upgrade -y
RUN apt-get install -y wget vim
RUN cd /root && wget https://www.dotdeb.org/dotdeb.gpg && apt-key add dotdeb.gpg
RUN echo "deb http://packages.dotdeb.org jessie all" >> /etc/apt/sources.list
RUN echo "deb-src http://packages.dotdeb.org jessie all" >> /etc/apt/sources.list
RUN echo "deb http://ftp.bg.debian.org/debian/ jessie main contrib non-free" >> /etc/apt/sources.list
RUN echo "deb-src http://ftp.bg.debian.org/debian/ jessie main contrib non-free" >> /etc/apt/sources.list
RUN apt-get update 

RUN apt-get install -y php7.0-fpm php7.0-xml git unzip curl apache2 libapache2-mod-fastcgi apache2-mpm-worker
RUN a2enmod actions fastcgi

RUN echo '\
<VirtualHost *:80>           \n\
DocumentRoot /var/www        \n\
<Directory "/var/www">       \n\
  Options All                \n\
  AllowOverride All          \n\
  Require all granted        \n\
</Directory>                 \n\
<Directory /usr/lib/cgi-bin> \n\
        Require all granted  \n\
    </Directory>             \n\
AddHandler php-cgi .php      \n\
Action php-cgi /php-cgi      \n\
Alias /php-cgi /usr/lib/cgi-bin/php  \n\
FastCgiExternalServer /usr/lib/cgi-bin/php -socket /var/run/php/php7.0-fpm.sock -pass-header Authorization  \n\
ErrorLog ${APACHE_LOG_DIR}/error.log \n\
</VirtualHost>               \n\
' > /etc/apache2/sites-available/tekstove-api.conf
RUN  a2dissite 000-default && a2ensite tekstove-api

RUN wget "https://getcomposer.org/download/1.3.0/composer.phar" -O /bin/composer && chmod +x /bin/composer

CMD /etc/init.d/apache2 restart && /etc/init.d/php7.0-fpm restart && tail -f /var/log/apache2/error.log
